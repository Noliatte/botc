<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>血染钟楼速查百科by Noliatte</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }



        .main-container {
            max-width: 1200px;
            margin: 1rem auto;
            padding: 0 2rem;
        }



        .content {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-section {
            margin-bottom: 2rem;
        }

        .search-box {
            width: 100%;
            padding: 1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .character-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .character-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .character-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .character-icon {
            width: 60px;
            height: 60px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            overflow: hidden;
        }

        .character-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .character-info h3 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
        }

        .character-faction {
            color: #666;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        /* 善良角色faction样式 */
        .character-faction.good {
            background: #e3f2fd;
            color: #2196f3;
        }

        /* 邪恶角色faction样式 */
        .character-faction.evil {
            background: #ffebee;
            color: #f44336;
        }

        /* 旅行角色faction样式 */
        .character-faction.travel {
            background: #f3e5f5;
            color: #9c27b0;
        }

        /* 传奇角色faction样式 */
        .character-faction.fabled {
            background: #fff8e1;
            color: #bf8f00;
        }

        .character-ability {
            color: #555;
            line-height: 1.5;
            margin-bottom: 1rem;
            white-space: pre-line;
        }

        /* 善良角色样式 */
        .character-ability.good {
            background-color: white;
            padding: 0.5rem;
            border-radius: 4px;
        }

        /* 邪恶角色样式 */
        .character-ability.evil {
            background-color: white;
            padding: 0.5rem;
            border-radius: 4px;
        }

        /* 旅行角色样式 */
        .character-ability.travel {
            background-color: white;
            padding: 0.5rem;
            border-radius: 4px;
        }

        /* 传奇角色样式 */
        .character-ability.fabled {
            background-color: white;
            padding: 0.5rem;
            border-radius: 4px;
        }

        .character-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tag {
            background: #e8f4fd;
            color: #3498db;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        /* 善良角色标签样式 */
        .tag.good {
            background: #e3f2fd;
            color: #2196f3;
        }

        /* 邪恶角色标签样式 */
        .tag.evil {
            background: #ffebee;
            color: #f44336;
        }

        /* 旅行角色标签样式 */
        .tag.travel {
            background: #f3e5f5;
            color: #9c27b0;
        }

        /* 传奇角色标签样式 */
        .tag.fabled {
            background: #fff8e1;
            color: #bf8f00;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .modal-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-icon {
            width: 120px;
            height: 120px;
            background: rgba(240, 240, 240, 0.6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 2rem;
            overflow: hidden;
            flex-shrink: 0;
        }

        .modal-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .modal-info h2 {
            color: #2c3e50;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-faction {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        /* 模态框中善良角色faction样式 */
        .modal-faction.good {
            background: #e3f2fd;
            color: #2196f3;
        }

        /* 模态框中邪恶角色faction样式 */
        .modal-faction.evil {
            background: #ffebee;
            color: #f44336;
        }

        /* 模态框中旅行角色faction样式 */
        .modal-faction.travel {
            background: #f3e5f5;
            color: #9c27b0;
        }

        /* 模态框中传奇角色faction样式 */
        .modal-faction.fabled {
            background: #fff8e1;
            color: #bf8f00;
        }

        .modal-flavor-brief {
            color: #888;
            font-size: 0.85rem;
            line-height: 1.4;
            font-style: italic;
            white-space: pre-line;
        }

        .modal-sections {
            margin-top: 1.5rem;
        }

        .modal-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }

        .modal-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .modal-section h3 {
            color: #2c3e50;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            padding-left: 1.2rem;
            position: relative;
        }

        .modal-section h3::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 8px;
            height: 8px;
            background-color: #999;
            transform: translateY(-50%) rotate(45deg);
        }

        .modal-ability {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            line-height: 1.6;
            border-left: 4px solid #3498db;
            white-space: pre-line;
        }

        /* 模态框中善良角色能力样式 */
        .modal-ability.good {
            background: #f8f9fa;
            border-left: 4px solid #2196f3;
        }

        /* 模态框中邪恶角色能力样式 */
        .modal-ability.evil {
            background: #f8f9fa;
            border-left: 4px solid #f44336;
        }

        /* 模态框中旅行角色能力样式 */
        .modal-ability.travel {
            background: #f8f9fa;
            border-left: 4px solid #9c27b0;
        }

        /* 模态框中传奇角色能力样式 */
        .modal-ability.fabled {
            background: #f8f9fa;
            border-left: 4px solid #bf8f00;
        }



        .hint-text {
            background: #fff8e1;
            padding: 1rem;
            border-radius: 8px;
            line-height: 1.6;
            border-left: 4px solid #ffa726;
            white-space: pre-line;
            color: #555;
        }

        .flavor-text {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            font-style: italic;
            color: #666;
            line-height: 1.6;
            border-left: 4px solid #9b59b6;
            white-space: pre-line;
        }

        .modal-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 0 1rem;
                margin: 1rem auto;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                padding: 0 1rem;
            }
            
            .logo {
                font-size: 1.5rem;
            }
            
            .characters-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .character-card {
                padding: 1rem;
            }
            
            .character-icon {
                width: 50px;
                height: 50px;
            }
            
            .character-info h3 {
                font-size: 1.1rem;
            }
            
            .character-ability {
                font-size: 0.9rem;
            }
            
            .search-box {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .modal-content {
                margin: 10% auto;
                padding: 1.5rem;
                width: 95%;
            }
            
            .modal-header {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .modal-icon {
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .modal-sections {
                margin-top: 1rem;
            }
            
            .modal-section {
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 0 0.5rem;
            }
            
            .header-content {
                padding: 0 0.5rem;
            }
            
            .content {
                padding: 0.8rem;
            }
            
            .character-card {
                padding: 0.8rem;
            }
            
            .character-header {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .character-icon {
                margin-right: 0;
                margin-bottom: 0.5rem;
            }
            
            .search-box {
                padding: 0.7rem;
                font-size: 0.8rem;
            }
            
            .tag {
                font-size: 0.7rem;
                padding: 0.2rem 0.4rem;
            }
        }
    </style>
</head>
<body>


    <div class="main-container">
        <main class="content">
            <div class="search-section">
                <input type="text" class="search-box" placeholder="搜索关键词" id="searchInput">
            </div>

            <div class="characters-grid" id="charactersGrid">
                <!-- 角色卡片将通过JavaScript动态生成 -->
            </div>
        </main>
    </div>

    <!-- 角色详情模态框 -->
    <div id="characterModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <div class="modal-icon" id="modalIcon">👤</div>
                <div class="modal-info">
                    <h2 id="modalNameContainer">
                        <span id="modalName">角色名称</span>
                        <span class="modal-faction" id="modalFaction">阵营</span>
                    </h2>
                    <div class="modal-flavor-brief" id="modalFlavorBrief">暂无背景故事</div>
                </div>
            </div>
            
            <div class="modal-sections">
                <div class="modal-section">
                    <h3>角色能力</h3>
                    <div class="modal-ability" id="modalAbility">
                        角色技能描述将在这里显示...
                    </div>
                </div>

                <div class="modal-section" id="hintSection" style="display: none;">
                    <h3>上帝小贴士</h3>
                    <div class="hint-text" id="modalHint">
                        上帝小贴士内容将在这里显示...
                    </div>
                </div>



                <div class="modal-section">
                    <h3>标签</h3>
                    <div class="modal-tags" id="modalTags">
                        <!-- 标签将在这里显示 -->
                    </div>
                </div>

                <div class="modal-section">
                    <h3>钟楼百科</h3>
                    <div class="wiki-link" id="modalWikiLink">
                        <a id="wikiLinkButton" href="#" target="_blank" style="
                            display: inline-block;
                            padding: 12px 24px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            text-decoration: none;
                            border-radius: 8px;
                            font-weight: 500;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'">
                            📖 查看钟楼百科详情
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 角色数据（将从JSON文件加载）
        let characters = [];

        // 从JSON文件加载角色数据
        async function loadCharacters() {
            try {
                // 显示加载状态
                showLoadingState();
                
                // 首先加载脚本配置文件
                const scriptsResponse = await fetch('scripts.json');
                const scriptsConfig = await scriptsResponse.json();
                
                // 并发加载所有脚本文件
                const scriptResponses = await Promise.all(
                    scriptsConfig.scripts.map(script => fetch(script.filename))
                );
                
                // 解析所有JSON数据
                const scriptDataArrays = await Promise.all(
                    scriptResponses.map(response => response.json())
                );
                
                // 合并所有角色数据
                characters = scriptDataArrays.flat();
                
                // 隐藏加载状态并渲染角色
                hideLoadingState();
                renderCharacters();
                
                console.log(`成功加载 ${scriptsConfig.scripts.length} 个剧本，共 ${characters.length} 个角色`);
            } catch (error) {
                console.error('加载角色数据失败:', error);
                hideLoadingState();
                
                // 如果加载失败，使用默认数据
                characters = [
                    {
                        id: 0,
                        name: "未找到角色",
                        icon: "https://clocktower-wiki.gstonegames.com/images/thumb/a/a7/Townsfolk.png/120px-Townsfolk.png",
                        faction: "镇民",
                        ability: "",
                        tags: [],
                        flavorText: "加载角色数据时出现错误，请检查网络连接或联系管理员。",

                    }
                ];
                renderCharacters();
            }
        }

        // 显示加载状态
        function showLoadingState() {
            const grid = document.getElementById('charactersGrid');
            grid.innerHTML = `
                <div style="text-align: center; padding: 2rem; grid-column: 1 / -1;">
                    <div style="font-size: 1.2rem; color: #666; margin-bottom: 1rem;">正在加载角色数据...</div>
                    <div style="display: inline-block; width: 20px; height: 20px; border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                </div>
            `;
            
            // 添加旋转动画样式
            if (!document.getElementById('loadingStyles')) {
                const style = document.createElement('style');
                style.id = 'loadingStyles';
                style.textContent = `
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // 隐藏加载状态
        function hideLoadingState() {
            // 加载状态会在renderCharacters时被替换
        }

        // 渲染角色卡片
        function renderCharacters(charactersToRender = characters) {
            const grid = document.getElementById('charactersGrid');
            grid.innerHTML = '';

            charactersToRender.forEach(character => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.onclick = () => showCharacterModal(character);
                
                // 根据camp字段确定样式类
                const campClass = character.camp === '善良' ? 'good' : character.camp === '邪恶' ? 'evil' : character.camp === '旅行' ? 'travel' : character.camp === '传奇' ? 'fabled' : '';
                
                card.innerHTML = `
                    <div class="character-header">
                        <div class="character-icon">
                            <img src="${character.icon}" alt="${character.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='👤';">
                        </div>
                        <div class="character-info">
                            <h3>${character.name}</h3>
                            <div class="character-faction ${campClass}">${character.faction}</div>
                        </div>
                    </div>
                    <div class="character-ability ${campClass}">${character.ability.replace(/\n/g, '<br>')}</div>
                    <div class="character-tags">
                        ${character.tags.map(tag => `<span class="tag ${campClass}">${tag}</span>`).join('')}
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // 显示角色详情模态框
        function showCharacterModal(character) {
            const modal = document.getElementById('characterModal');
            const modalIcon = document.getElementById('modalIcon');
            const modalName = document.getElementById('modalName');
            const modalFaction = document.getElementById('modalFaction');
            const modalFlavorBrief = document.getElementById('modalFlavorBrief');
            const modalAbility = document.getElementById('modalAbility');
            const hintSection = document.getElementById('hintSection');
            const modalHint = document.getElementById('modalHint');
            const modalTags = document.getElementById('modalTags');

            // 设置图标
            modalIcon.innerHTML = `<img src="${character.icon}" alt="${character.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='👤';">`;

            // 根据camp字段确定样式类
            const campClass = character.camp === '善良' ? 'good' : character.camp === '邪恶' ? 'evil' : character.camp === '旅行' ? 'travel' : character.camp === '传奇' ? 'fabled' : '';
            
            // 填充基本信息
            modalName.textContent = character.name;
            modalFaction.textContent = character.faction;
            modalFaction.className = `modal-faction ${campClass}`;
            modalFlavorBrief.innerHTML = (character.flavorText || '暂无背景故事').replace(/\n/g, '<br>');
            
            // 设置模态框中的角色能力样式
            modalAbility.className = `modal-ability ${campClass}`;
            modalAbility.innerHTML = character.ability.replace(/\n/g, '<br>');
            
            // 处理上帝小贴士
            if (character.hint) {
                hintSection.style.display = 'block';
                modalHint.innerHTML = character.hint.replace(/\n/g, '<br>');
            } else {
                hintSection.style.display = 'none';
            }
            

            
            modalTags.innerHTML = character.tags.map(tag => `<span class="tag ${campClass}">${tag}</span>`).join('');

            // 设置钟楼百科链接
            const wikiLinkButton = document.getElementById('wikiLinkButton');
            const wikiUrl = `https://clocktower-wiki.gstonegames.com/index.php?title=${character.name}`;
            wikiLinkButton.href = wikiUrl;

            modal.style.display = 'block';
        }

        // 搜索功能
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                const filteredCharacters = characters.filter(character => 
                    character.name.toLowerCase().includes(searchTerm) ||
                    character.id.toLowerCase().includes(searchTerm) ||
                    character.faction.toLowerCase().includes(searchTerm) ||
                    character.script.toLowerCase().includes(searchTerm) ||
                    character.tags.some(tag => tag.toLowerCase().includes(searchTerm))
                );
                renderCharacters(filteredCharacters);
            });
        }

        // 模态框关闭功能
        function setupModal() {
            const modal = document.getElementById('characterModal');
            const closeBtn = document.querySelector('.close');
            
            closeBtn.onclick = () => {
                modal.style.display = 'none';
            };
            
            window.onclick = (event) => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        }



        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadCharacters();
            setupSearch();
            setupModal();
        });
    </script>
</body>
</html>
